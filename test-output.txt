
> pi-rlm@0.1.0 test
> vitest


 DEV  v1.6.1 /Users/csells/Code/csells/pi-rlm

 ✓ tests/unit/manifest.test.ts  (16 tests) 4ms
stdout | tests/unit/store.test.ts > ExternalStore > initialize() > should create directory if it does not exist
[pi-rlm] No existing store index, creating new store

 ✓ tests/component/widget.test.ts  (21 tests) 15ms
stdout | tests/unit/store.test.ts > ExternalStore > add() > should add a record and return it with generated id and createdAt
[pi-rlm] No existing store index, creating new store

 ✓ tests/unit/fingerprint.test.ts  (38 tests) 5ms
stderr | tests/unit/fingerprint.test.ts > messageFingerprint > should generate fallback fingerprint for messages without timestamp
[pi-rlm] Message without timestamp — fingerprint fallback

stderr | tests/unit/fingerprint.test.ts > messageFingerprint > should generate same fingerprint for same content without timestamp
[pi-rlm] Message without timestamp — fingerprint fallback
[pi-rlm] Message without timestamp — fingerprint fallback

stdout | tests/unit/store.test.ts > ExternalStore > add() > should generate unique IDs for each record
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > get() > should return a record by id
[pi-rlm] No existing store index, creating new store

 ✓ tests/unit/externalizer.test.ts  (9 tests) 6ms
stdout | tests/unit/store.test.ts > ExternalStore > get() > should return null for missing id
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > getAllIds() > should return all object IDs
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > getAllIds() > should return empty array when store is empty
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > getFullIndex() > should return StoreIndex structure with all fields
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > getFullIndex() > should return independent copy of index
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > findByIngestPath() > should find a record by ingest path
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > findByIngestPath() > should return null for non-existent path
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > findByIngestPath() > should only match ingested records, not other kinds
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > flush() > should write pending data to disk
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > flush() > should resolve when queue is empty
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > clear() > should remove files and reset state
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > rebuildExternalizedMap() > should populate externalized map from records with externalized source
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > rebuildExternalizedMap() > should clear previous map entries when rebuilding
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > getExternalizedId() > should return object ID for fingerprint
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > getExternalizedId() > should return null for missing fingerprint
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > addExternalized() > should register an externalized message
[pi-rlm] No existing store index, creating new store

stdout | tests/unit/store.test.ts > ExternalStore > addExternalized() > should overwrite existing fingerprint mapping
[pi-rlm] No existing store index, creating new store

 ❯ tests/unit/store.test.ts  (22 tests | 6 failed) 25ms
   ❯ tests/unit/store.test.ts > ExternalStore > add() > should add a record and return it with generated id and createdAt
     → ENOTEMPTY: directory not empty, rmdir '/var/folders/kn/nhy_d5ts69g0jjdqkkkyjq400000gn/T/pi-rlm-store-WHWfLR'
   ❯ tests/unit/store.test.ts > ExternalStore > add() > should generate unique IDs for each record
     → ENOTEMPTY: directory not empty, rmdir '/var/folders/kn/nhy_d5ts69g0jjdqkkkyjq400000gn/T/pi-rlm-store-z4kGVU'
   ❯ tests/unit/store.test.ts > ExternalStore > getAllIds() > should return all object IDs
     → ENOTEMPTY: directory not empty, rmdir '/var/folders/kn/nhy_d5ts69g0jjdqkkkyjq400000gn/T/pi-rlm-store-nmMXkw'
   ❯ tests/unit/store.test.ts > ExternalStore > findByIngestPath() > should only match ingested records, not other kinds
     → ENOTEMPTY: directory not empty, rmdir '/var/folders/kn/nhy_d5ts69g0jjdqkkkyjq400000gn/T/pi-rlm-store-nuFNOX'
   ❯ tests/unit/store.test.ts > ExternalStore > rebuildExternalizedMap() > should populate externalized map from records with externalized source
     → ENOTEMPTY: directory not empty, rmdir '/var/folders/kn/nhy_d5ts69g0jjdqkkkyjq400000gn/T/pi-rlm-store-NWfzPs'
   ❯ tests/unit/store.test.ts > ExternalStore > rebuildExternalizedMap() > should clear previous map entries when rebuilding
     → ENOTEMPTY: directory not empty, rmdir '/var/folders/kn/nhy_d5ts69g0jjdqkkkyjq400000gn/T/pi-rlm-store-bDNhnl'
 ❯ tests/unit/write-queue.test.ts  (17 tests | 3 failed) 137ms
   ❯ tests/unit/write-queue.test.ts > WriteQueue > Error handling > should continue processing remaining tasks after error
     → Task 2 failed
   ❯ tests/unit/write-queue.test.ts > WriteQueue > getQueueLength() > should accurately report queue length during processing
     → expected 0 to be greater than 0
   ❯ tests/unit/write-queue.test.ts > WriteQueue > Task execution semantics > should resolve promise for each task individually
     → expected true to be false // Object.is equality
 ✓ tests/unit/warm-tracker.test.ts  (23 tests) 4ms
 ✓ tests/unit/cost-estimator.test.ts  (12 tests) 3ms
 ✓ tests/unit/call-tree.test.ts  (16 tests) 3ms
 ✓ tests/unit/tokens.test.ts  (19 tests) 4ms
 ✓ tests/unit/token-oracle-integration.test.ts  (4 tests) 6ms
 ✓ tests/unit/token-oracle.test.ts  (11 tests) 8ms
 ✓ tests/component/tools-query.test.ts  (7 tests) 250ms
stderr | tests/component/tools-query.test.ts > rlm_query tool > execute > should return error when no model is available
[pi-rlm] No model available for child call

 ✓ tests/unit/concurrency.test.ts  (6 tests) 89ms
 ✓ tests/unit/ingest.test.ts  (4 tests) 26ms
 ✓ tests/unit/search.test.ts  (6 tests) 42ms
 ✓ tests/unit/stats.test.ts  (2 tests) 3ms
 ✓ tests/unit/peek.test.ts  (4 tests) 4ms
 ❯ tests/e2e/scenario-ingest-and-analyze.test.ts  (2 tests) 30004ms
 ❯ tests/e2e/scenario-long-session.test.ts  (2 tests) 30011ms
 ❯ tests/e2e/scenario-cross-turn-retrieval.test.ts  (2 tests) 30006ms
 ❯ tests/e2e/scenario-disable-enable.test.ts  (1 test) 30006ms
 ✓ tests/unit/regex-timeout.test.ts  (2 tests) 27ms
